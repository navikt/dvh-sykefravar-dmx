{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2026-01-22T13:11:13.327619Z", "invocation_id": "2ca45638-0561-4b0b-b8b0-4fce53dd2040", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.260302Z", "completed_at": "2026-01-22T12:51:16.291820Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.299176Z", "completed_at": "2026-01-22T12:51:16.683095Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.464916467666626, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_kodeverk__dim_alder", "compiled": true, "compiled_code": "with source as (\n      select * from dt_kodeverk.dim_alder\n)\n\nselect * from source", "relation_name": "dvh_syfo.felles_dt_kodeverk__dim_alder", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.273480Z", "completed_at": "2026-01-22T12:51:16.296477Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.324130Z", "completed_at": "2026-01-22T12:51:16.698254Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.4699270725250244, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_kodeverk__dim_organisasjon", "compiled": true, "compiled_code": "with source as (\n      select * from dt_kodeverk.dim_organisasjon\n)\n\nselect * from source", "relation_name": "dvh_syfo.felles_dt_kodeverk__dim_organisasjon", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.277026Z", "completed_at": "2026-01-22T12:51:16.304279Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.337649Z", "completed_at": "2026-01-22T12:51:16.727143Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.493788480758667, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_p__dim_naering", "compiled": true, "compiled_code": "with source as (\n      select * from dt_p.dim_naering\n)\n\nselect * from source", "relation_name": "dvh_syfo.felles_dt_p__dim_naering", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.280344Z", "completed_at": "2026-01-22T12:51:16.298183Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.331188Z", "completed_at": "2026-01-22T12:51:16.731671Z"}], "thread_id": "Thread-6 (worker)", "execution_time": 0.5024662017822266, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_p__dim_virksomhet", "compiled": true, "compiled_code": "with source as (\n      select * from dt_p.dim_virksomhet\n)\nselect * from source", "relation_name": "dvh_syfo.felles_dt_p__dim_virksomhet", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.283825Z", "completed_at": "2026-01-22T12:51:16.297613Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.327345Z", "completed_at": "2026-01-22T12:51:16.735881Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.5027272701263428, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_p__fak_sf_hendelse_dag", "compiled": true, "compiled_code": "with source as (\n      select * from dt_p.fak_sf_hendelse_dag\n)\n\nselect * from source", "relation_name": "dvh_syfo.felles_dt_p__fak_sf_hendelse_dag", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.287050Z", "completed_at": "2026-01-22T12:51:16.298718Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.334602Z", "completed_at": "2026-01-22T12:51:16.734044Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 0.5037539005279541, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_person__dim_person1", "compiled": true, "compiled_code": "WITH source AS (\n  SELECT * FROM dt_person.dim_person1\n)\n\nSELECT * FROM source", "relation_name": "dvh_syfo.felles_dt_person__dim_person1", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.269515Z", "completed_at": "2026-01-22T12:51:16.295411Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.320307Z", "completed_at": "2026-01-22T12:51:16.739181Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.5101191997528076, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_kodeverk__dim_org", "compiled": true, "compiled_code": "with source as (\n      select * from dt_kodeverk.dim_org\n)\n\nselect * from source", "relation_name": "dvh_syfo.felles_dt_kodeverk__dim_org", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.292585Z", "completed_at": "2026-01-22T12:51:16.323571Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.342014Z", "completed_at": "2026-01-22T12:51:16.737672Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 0.5053098201751709, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.felles_dt_person__ident_off_id_til_fk_person1", "compiled": true, "compiled_code": "WITH source AS (\n  SELECT * FROM dt_person.IDENT_OFF_ID_TIL_FK_PERSON1\n  )\n\nSELECT * FROM source", "relation_name": "dvh_syfo.felles_dt_person__ident_off_id_til_fk_person1", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.770409Z", "completed_at": "2026-01-22T12:51:16.778340Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.780516Z", "completed_at": "2026-01-22T12:51:17.113795Z"}], "thread_id": "Thread-11 (worker)", "execution_time": 0.36467671394348145, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__omkode_arena_hendelse", "compiled": true, "compiled_code": "WITH arena AS (\n  SELECT * FROM dvh_syfo.felles_dt_p__fak_sf_hendelse_dag\n)\n\n,final AS (\n  SELECT\n    arena.fk_person1\n    ,TO_DATE(TO_CHAR(arena.fk_dim_tid_ident_dato), 'YYYYMMDD') AS tilfelle_startdato\n    ,TO_DATE(TO_CHAR(arena.fk_dim_tid_dato_hendelse), 'YYYYMMDD') AS hendelse_tidspunkt\n    ,\n    CASE\n      when arena.fk_dim_sf_hendelsestype in (105,179) then\n      TO_DATE(TO_CHAR(arena.fk_dim_tid_dato_hendelse), 'YYYYMMDD')\n    END AS dialogmote_tidspunkt\n    ,arena.ansv_kontor AS enhet_nr\n    ,DECODE(arena.fk_dim_sf_hendelsestype\n      ,105 ,'FERDIGSTILT'\n      ,179 ,'FERDIGSTILT'\n      ,93  ,'STOPPUNKT'\n      ,108 ,'UNNTAK'\n    ) AS hendelse\n    ,arena.kildesystem\n    ,arena.pk_fak_sf_hendelse_dag AS kilde_uuid\n  FROM arena\n  WHERE\n    arena.fk_dim_sf_hendelsestype IN (\n      105  -- DM2\n      ,179 -- DM3\n      ,93  -- Kandidat DM2\n      ,108 -- Unntak DM2\n    )\n    AND arena.gyldig_flagg = 1\n    AND arena.kildesystem = 'ARENA'\n    AND arena.fk_dim_tid_ident_dato > 20190000 and arena.fk_dim_tid_ident_dato < 20240000 -- TODO: Filtrer bort data som er d\u00e5rlige\n)\n\nselect * from final", "relation_name": "dvh_syfo.mk_dialogmote__omkode_arena_hendelse", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.792228Z", "completed_at": "2026-01-22T12:51:16.797755Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.804835Z", "completed_at": "2026-01-22T12:51:17.112262Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.3549468517303467, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fk_modia__motebehov", "compiled": true, "compiled_code": "WITH motebehov AS (\n  SELECT * FROM dvh_syfo.fk_motebehov\n)\n,dvh_person_ident AS (\n    SELECT * FROM dvh_syfo.felles_dt_person__ident_off_id_til_fk_person1\n)\n ,join_fk_person_sm AS (\n    SELECT\n        motebehov.*,\n        dvh_person_ident.fk_person1 as fk_person1_sm\n        from motebehov\n    LEFT JOIN dvh_person_ident\n    ON\n      motebehov.sm_fnr = dvh_person_ident.off_id\n      AND dvh_person_ident.gyldig_til_dato = TO_DATE('9999-12-31', 'YYYY-MM-DD')\n)\n, join_fk_person1_2 as (\n    select\n    join_fk_person_sm.*,\n    dvh_person_ident.fk_person1 as fk_person1_opprettet_av\n    from join_fk_person_sm\n  left join dvh_person_ident\n    ON\n      join_fk_person_sm.opprettet_av_fnr = dvh_person_ident.off_id\n      AND dvh_person_ident.gyldig_til_dato = TO_DATE('9999-12-31', 'YYYY-MM-DD')\n)\n, final as (\n  SELECT\n    MOTEBEHOV_UUID,\n    OPPRETTET_DATO,\n    VIRKSOMHETSNUMMER,\n    HAR_MOTEBEHOV,\n    TILDELT_ENHET,\n    BEHANDLET_TIDSPUNKT,\n    BEHANDLET_VEILEDER_IDENT,\n    SKJEMATYPE,\n    LASTET_DATO,\n    KILDESYSTEM,\n    FK_PERSON1_SM,\n    FK_PERSON1_OPPRETTET_AV\n  FROM join_fk_person1_2\n)\n\nselect * from final", "relation_name": "dvh_syfo.fk_modia__motebehov", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.785411Z", "completed_at": "2026-01-22T12:51:16.797259Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.801747Z", "completed_at": "2026-01-22T12:51:17.126361Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.36622023582458496, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fk_modia__dialogmote", "compiled": true, "compiled_code": "WITH dialogmote AS (\n    select dialogmote.kafka_message.dialogmoteUuid as kilde_uuid,\n    CAST(TO_TIMESTAMP_TZ(dialogmote.kafka_message.dialogmoteTidspunkt, 'YYYY-MM-DD HH24:MI:SS:TZH:TZM') at TIME ZONE 'CET' as timestamp) AS dialogmote_tidspunkt,\n    dialogmote.kafka_message.statusEndringType as hendelse,\n    CAST(TO_TIMESTAMP_TZ(dialogmote.kafka_message.statusEndringTidspunkt, 'YYYY-MM-DD HH24:MI:SS.FF:TZH:TZM') at TIME ZONE 'CET' as timestamp) AS hendelse_tidspunkt,\n    person.fk_person1 as fk_person1,\n    dialogmote.kafka_message.virksomhetsnummer as virksomhetsnr,\n    dialogmote.kafka_message.enhetNr as enhet_nr,\n    dialogmote.kafka_message.navIdent as nav_ident,\n    CAST(TO_TIMESTAMP_TZ(dialogmote.kafka_message.tilfelleStartdato, 'YYYY-MM-DD HH24:MI:SS:TZH:TZM') at TIME ZONE 'CET' as timestamp) AS tilfelle_startdato,\n    DECODE(dialogmote.kafka_message.arbeidstaker, 'true', 1, 'false', 0) AS arbeidstaker_flagg,\n    DECODE(dialogmote.kafka_message.arbeidsgiver, 'true', 1, 'false', 0) AS arbeidsgiver_flagg,\n    DECODE(dialogmote.kafka_message.sykmelder, 'true', 1, 'false', 0) AS sykmelder_flagg,\n    dialogmote.kafka_topic,\n    dialogmote.kafka_partisjon,\n    dialogmote.kafka_offset,\n    dialogmote.kafka_mottatt_dato,\n    dialogmote.lastet_dato,\n    dialogmote.kildesystem\n  from dvh_syfo.raw_isdialogmote dialogmote\n  inner join dvh_syfo.felles_dt_person__ident_off_id_til_fk_person1 person\n          on person.off_id = dialogmote.kafka_message.personIdent\n         and person.gyldig_til_dato = to_date('31.12.9999','DD.MM.YYYY') -- henter gyldige\n         and person.skjermet_kode not in (6, 7) -- fjerner skjerma personer\n),\n\nfinal as (\n  select kilde_uuid,\n         dialogmote_tidspunkt,\n         hendelse,\n         hendelse_tidspunkt,\n         fk_person1,\n         virksomhetsnr,\n         enhet_nr,\n         nav_ident,\n         tilfelle_startdato,\n         arbeidstaker_flagg,\n         arbeidsgiver_flagg,\n         sykmelder_flagg,\n         kafka_topic,\n         kafka_partisjon,\n         kafka_offset,\n         kafka_mottatt_dato,\n         lastet_dato,\n         kildesystem\n  from dialogmote\n)\n\nselect * from final", "relation_name": "dvh_syfo.fk_modia__dialogmote", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:16.789238Z", "completed_at": "2026-01-22T12:51:16.796036Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:16.798141Z", "completed_at": "2026-01-22T12:51:17.180468Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.4201958179473877, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fk_modia__kandidat", "compiled": true, "compiled_code": "WITH kandidater AS (\n  SELECT * FROM dvh_syfo.raw_isdialogmotekandidat\n)\n, final AS (\n  SELECT\n    kandidater.kafka_message.uuid as kilde_uuid,\n    CAST(TO_TIMESTAMP(kandidater.kafka_message.createdAt, 'yyyy-mm-dd\"T\"hh24:mi:ss.fftzh:tzm') at TIME ZONE 'CET' as timestamp) AS hendelse_tidspunkt,\n    person.fk_person1 as fk_person1,\n    DECODE(kandidater.kafka_message.kandidat, 'true', 1, 'false', 0) AS kandidat_flagg,\n    kandidater.kafka_message.arsak as hendelse,\n    kandidater.kafka_message.unntakArsak as unntakarsak,\n    TO_DATE(kandidater.kafka_message.tilfelleStart, 'YYYY-MM-DD') as tilfelle_startdato,\n    kandidater.kafka_message.unntakVeilederident as nav_ident,\n    kafka_topic,\n    kafka_partisjon,\n    kafka_offset,\n    kafka_mottatt_dato,\n    lastet_dato,\n    kildesystem\n  FROM kandidater kandidater\n  inner join dvh_syfo.felles_dt_person__ident_off_id_til_fk_person1 person\n          on person.off_id = kandidater.kafka_message.personIdentNumber\n         and person.gyldig_til_dato = to_date('31.12.9999','DD.MM.YYYY') -- henter gyldige\n         and person.skjermet_kode not in (6, 7) -- fjerner skjerma personer\n)\nSELECT * FROM final", "relation_name": "dvh_syfo.fk_modia__kandidat", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:17.147537Z", "completed_at": "2026-01-22T12:51:17.151281Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:17.151812Z", "completed_at": "2026-01-22T12:51:17.462436Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.3338146209716797, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fk_modia__dialogmote_patch", "compiled": true, "compiled_code": "/*bytter ut tilfellestartdato som har blitt feil fra kilden*/\n\nwith dialogmote_forkammer as\n(SELECT * FROM dvh_syfo.fk_modia__dialogmote)\n\n, dialogmote_patch as (\n  select dialogmote_forkammer.*,\n  case\n  when kilde_uuid = '92097f17-1e02-4449-8eaf-d5a50d05220e' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-06-01','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = 'c7745c33-fdff-42f8-a6dc-5d3dc4aed983' and hendelse in ('INNKALT','NYTT_TID_STED','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-01-06','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra arena hendelse*/\n  when kilde_uuid = 'b31aef9f-afaa-4d8e-9f31-d9d7d1bb3819' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-08-28','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = '57c2abe2-062d-45bd-b51d-898e063cd13b' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-09-08', 'YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = '5b3881ac-e5da-4d57-a4e5-5eeb90bf645a' and hendelse in ('INNKALT', 'FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-03-20','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = '159d7f6e-4ecf-487d-bf9e-1c9a8fb89e0d' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-02-21','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = '9358c264-6871-4bad-b62b-a3245b52530e' and hendelse in ('INNKALT','NYTT_TID_STED','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2021-12-17','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = '4dfdc657-5879-40fc-a096-75d7562298c2' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-08-18','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen modia hendelse*/\n  when kilde_uuid = 'a2e8cd59-9eb4-44c7-bf4a-feb1da44312f' and hendelse in ('FERDIGSTILT', 'INNKALT') then CAST(TO_TIMESTAMP_TZ('2022-01-29','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra arena oppfolging*/\n  when kilde_uuid = 'd6ed14e0-a98f-44fb-a114-88448b372b16' and hendelse in ('INNKALT','NYTT_TID_STED','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-09-12','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra arena oppfolging*/\n  when kilde_UUid = '812a477c-2543-427f-8cdb-fbef59f36123' and hendelse in ('FERDIGSTILT','INNKALT') then CAST(TO_TIMESTAMP_TZ('2022-02-28','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra arena/infotrygd*/\n  when kilde_uuid = '3b5e4b16-3576-49c4-ba44-2393848e3fc5' and hendelse in ('INNKALT','NYTT_TID_STED','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-08-12','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra infotrygd/arena, fant ikke noe i sykm*/\n  when kilde_uuid = '1662ee9f-5186-4c5b-a43b-bd0c926d8d19' and hendelse in ('FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2022-09-14','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen dialogmote hendelse*/\n  when kilde_uuid = '7352a6f3-d7e2-4676-a2fe-de0c55f59f68' and hendelse in ('FERDIGSTILT','INNKALT') then  CAST(TO_TIMESTAMP_TZ('2023-01-23','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra sf_oppfolging*/\n  when kilde_uuid = '7574b760-cef4-44a7-9c21-463055fd6a36' and hendelse in ('FERDIGSTILT','INNKALT') then  CAST(TO_TIMESTAMP_TZ('2023-10-09','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra sf_oppfolging og sykm_sykmelding*/\n  when kilde_uuid = 'a5a7e0c1-a7b1-428c-b868-0b747cd51009' and hendelse in ('FERDIGSTILT','INNKALT', 'NYTT_TID_STED') then  CAST(TO_TIMESTAMP_TZ('2024-04-05','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra sykm_sykmelding*/\n  when kilde_uuid = '9f0795df-dd18-4c9a-8720-8eef63fa03f4' and hendelse in ('INNKALT','NYTT_TID_STED','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2024-09-18','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen dialogmote hendelse*/\n  when kilde_uuid = 'ed082aab-3881-44c6-b386-1cfca0e94199' and hendelse in ('INNKALT','FERDIGSTILT') then CAST(TO_TIMESTAMP_TZ('2025-02-17','YYYY-MM-DD') at TIME ZONE 'CET' as timestamp) /*hentet fra annen dialogmote hendelse*/\n  else tilfelle_startdato\n  end\n  tilfelle_startdato_patch\n  from dialogmote_forkammer\n)\n\n, final AS (\n  SELECT\n    kilde_uuid,\n    dialogmote_tidspunkt,\n    hendelse,\n    hendelse_tidspunkt,\n    fk_person1,\n    virksomhetsnr,\n    enhet_nr,\n    nav_ident,\n    tilfelle_startdato_patch as tilfelle_startdato,\n    arbeidstaker_flagg,\n    arbeidsgiver_flagg,\n    sykmelder_flagg,\n    kafka_topic,\n    kafka_partisjon,\n    kafka_offset,\n    kafka_mottatt_dato,\n    lastet_dato,\n    kildesystem\n  FROM dialogmote_patch\n)\n\nSELECT * FROM final", "relation_name": "dvh_syfo.fk_modia__dialogmote_patch", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:17.203121Z", "completed_at": "2026-01-22T12:51:17.207286Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:17.207789Z", "completed_at": "2026-01-22T12:51:17.537409Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 0.35353755950927734, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fk_modia__kandidat_unntak", "compiled": true, "compiled_code": "WITH kandidater AS (\n  SELECT * FROM dvh_syfo.fk_modia__kandidat\n),\n\nfinal as (\n  select\n    k.kilde_uuid,\n    k.hendelse_tidspunkt,\n    k.fk_person1,\n    k.kandidat_flagg,\n    k.hendelse,\n    k.unntakarsak,\n    k.tilfelle_startdato,\n    nvl(u.created_by, k.nav_ident) as nav_ident,\n    k.kafka_topic,\n    k.kafka_partisjon,\n    k.kafka_offset,\n    k.kafka_mottatt_dato,\n    k.lastet_dato,\n    k.kildesystem\n  from kandidater k\n  left outer join dvh_syfo.fk_dm_unntak_historikk_2023_til_2025 u\n    on k.fk_person1 = u.fk_person1\n    and trunc(k.hendelse_tidspunkt) = u.created_at\n)\n\nselect * from final", "relation_name": "dvh_syfo.fk_modia__kandidat_unntak", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:17.560999Z", "completed_at": "2026-01-22T12:51:18.275971Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:18.276462Z", "completed_at": "2026-01-22T12:51:18.387663Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 0.8463048934936523, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__union", "compiled": true, "compiled_code": "/********************************************************\n*I denne modellen sl\u00e5s hendelser fra\n*modia kandidatliste (arsak) med hendelser fra modia dialogmote\n*(status_endring_type) sammen til en felles stuktur\n*sl\u00e5r sammen kolonner fra de to systemene med ulikt navn\n*men samme innehold vha decode\n*********************************************************/\nWITH union_all AS (\n  \n    \n\n        (\n            select\n\n                \n                    cast(\"KILDE_UUID\" as VARCHAR2(4000)) as \"KILDE_UUID\" ,\n                    cast(\"HENDELSE_TIDSPUNKT\" as TIMESTAMP(6)) as \"HENDELSE_TIDSPUNKT\" ,\n                    cast(\"FK_PERSON1\" as NUMBER(38,0)) as \"FK_PERSON1\" ,\n                    cast(\"KANDIDAT_FLAGG\" as NUMBER) as \"KANDIDAT_FLAGG\" ,\n                    cast(\"HENDELSE\" as VARCHAR2(4000)) as \"HENDELSE\" ,\n                    cast(\"UNNTAKARSAK\" as VARCHAR2(4000)) as \"UNNTAKARSAK\" ,\n                    cast(\"TILFELLE_STARTDATO\" as DATE) as \"TILFELLE_STARTDATO\" ,\n                    cast(\"NAV_IDENT\" as VARCHAR2(4000)) as \"NAV_IDENT\" ,\n                    cast(\"KAFKA_TOPIC\" as VARCHAR2(255)) as \"KAFKA_TOPIC\" ,\n                    cast(\"KAFKA_PARTISJON\" as NUMBER) as \"KAFKA_PARTISJON\" ,\n                    cast(\"KAFKA_OFFSET\" as NUMBER) as \"KAFKA_OFFSET\" ,\n                    cast(\"KAFKA_MOTTATT_DATO\" as DATE) as \"KAFKA_MOTTATT_DATO\" ,\n                    cast(\"LASTET_DATO\" as DATE) as \"LASTET_DATO\" ,\n                    cast(\"KILDESYSTEM\" as VARCHAR2(50)) as \"KILDESYSTEM\" ,\n                    cast(null as TIMESTAMP(6)) as \"DIALOGMOTE_TIDSPUNKT\" ,\n                    cast(null as VARCHAR2(4000)) as \"VIRKSOMHETSNR\" ,\n                    cast(null as VARCHAR2(4000)) as \"ENHET_NR\" ,\n                    cast(null as NUMBER) as \"ARBEIDSTAKER_FLAGG\" ,\n                    cast(null as NUMBER) as \"ARBEIDSGIVER_FLAGG\" ,\n                    cast(null as NUMBER) as \"SYKMELDER_FLAGG\" \n\n            from dvh_syfo.fk_modia__kandidat_unntak\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n\n                \n                    cast(\"KILDE_UUID\" as VARCHAR2(4000)) as \"KILDE_UUID\" ,\n                    cast(\"HENDELSE_TIDSPUNKT\" as TIMESTAMP(6)) as \"HENDELSE_TIDSPUNKT\" ,\n                    cast(\"FK_PERSON1\" as NUMBER(38,0)) as \"FK_PERSON1\" ,\n                    cast(null as NUMBER) as \"KANDIDAT_FLAGG\" ,\n                    cast(\"HENDELSE\" as VARCHAR2(4000)) as \"HENDELSE\" ,\n                    cast(null as VARCHAR2(4000)) as \"UNNTAKARSAK\" ,\n                    cast(\"TILFELLE_STARTDATO\" as DATE) as \"TILFELLE_STARTDATO\" ,\n                    cast(\"NAV_IDENT\" as VARCHAR2(4000)) as \"NAV_IDENT\" ,\n                    cast(\"KAFKA_TOPIC\" as VARCHAR2(255)) as \"KAFKA_TOPIC\" ,\n                    cast(\"KAFKA_PARTISJON\" as NUMBER) as \"KAFKA_PARTISJON\" ,\n                    cast(\"KAFKA_OFFSET\" as NUMBER) as \"KAFKA_OFFSET\" ,\n                    cast(\"KAFKA_MOTTATT_DATO\" as DATE) as \"KAFKA_MOTTATT_DATO\" ,\n                    cast(\"LASTET_DATO\" as DATE) as \"LASTET_DATO\" ,\n                    cast(\"KILDESYSTEM\" as VARCHAR2(50)) as \"KILDESYSTEM\" ,\n                    cast(\"DIALOGMOTE_TIDSPUNKT\" as TIMESTAMP(6)) as \"DIALOGMOTE_TIDSPUNKT\" ,\n                    cast(\"VIRKSOMHETSNR\" as VARCHAR2(4000)) as \"VIRKSOMHETSNR\" ,\n                    cast(\"ENHET_NR\" as VARCHAR2(4000)) as \"ENHET_NR\" ,\n                    cast(\"ARBEIDSTAKER_FLAGG\" as NUMBER) as \"ARBEIDSTAKER_FLAGG\" ,\n                    cast(\"ARBEIDSGIVER_FLAGG\" as NUMBER) as \"ARBEIDSGIVER_FLAGG\" ,\n                    cast(\"SYKMELDER_FLAGG\" as NUMBER) as \"SYKMELDER_FLAGG\" \n\n            from dvh_syfo.fk_modia__dialogmote_patch\n\n            \n        )\n\n        union all\n        \n\n        (\n            select\n\n                \n                    cast(\"KILDE_UUID\" as VARCHAR2(4000)) as \"KILDE_UUID\" ,\n                    cast(\"HENDELSE_TIDSPUNKT\" as TIMESTAMP(6)) as \"HENDELSE_TIDSPUNKT\" ,\n                    cast(\"FK_PERSON1\" as NUMBER(38,0)) as \"FK_PERSON1\" ,\n                    cast(null as NUMBER) as \"KANDIDAT_FLAGG\" ,\n                    cast(\"HENDELSE\" as VARCHAR2(4000)) as \"HENDELSE\" ,\n                    cast(null as VARCHAR2(4000)) as \"UNNTAKARSAK\" ,\n                    cast(\"TILFELLE_STARTDATO\" as DATE) as \"TILFELLE_STARTDATO\" ,\n                    cast(null as VARCHAR2(4000)) as \"NAV_IDENT\" ,\n                    cast(null as VARCHAR2(255)) as \"KAFKA_TOPIC\" ,\n                    cast(null as NUMBER) as \"KAFKA_PARTISJON\" ,\n                    cast(null as NUMBER) as \"KAFKA_OFFSET\" ,\n                    cast(null as DATE) as \"KAFKA_MOTTATT_DATO\" ,\n                    cast(null as DATE) as \"LASTET_DATO\" ,\n                    cast(\"KILDESYSTEM\" as VARCHAR2(50)) as \"KILDESYSTEM\" ,\n                    cast(\"DIALOGMOTE_TIDSPUNKT\" as TIMESTAMP(6)) as \"DIALOGMOTE_TIDSPUNKT\" ,\n                    cast(null as VARCHAR2(4000)) as \"VIRKSOMHETSNR\" ,\n                    cast(\"ENHET_NR\" as VARCHAR2(4000)) as \"ENHET_NR\" ,\n                    cast(null as NUMBER) as \"ARBEIDSTAKER_FLAGG\" ,\n                    cast(null as NUMBER) as \"ARBEIDSGIVER_FLAGG\" ,\n                    cast(null as NUMBER) as \"SYKMELDER_FLAGG\" \n\n            from dvh_syfo.mk_dialogmote__omkode_arena_hendelse\n\n            \n        )\n\n        \n)\n,\nfinal as (\n    SELECT\n      fk_person1,\n      tilfelle_startdato,\n      hendelse,\n      hendelse_tidspunkt,\n      dialogmote_tidspunkt,\n      unntakarsak,\n      enhet_nr,\n      nav_ident,\n      arbeidstaker_flagg,\n      arbeidsgiver_flagg,\n      sykmelder_flagg,\n      kilde_uuid,\n      kildesystem,\n      virksomhetsnr\n    FROM union_all\n)\nselect * from final", "relation_name": "dvh_syfo.mk_dialogmote__union", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:18.410963Z", "completed_at": "2026-01-22T12:51:18.414049Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:18.414542Z", "completed_at": "2026-01-22T12:51:18.754760Z"}], "thread_id": "Thread-11 (worker)", "execution_time": 0.3632349967956543, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__filtrert_hendelse", "compiled": true, "compiled_code": "/************************************************'\n*I denne modellen velges kun hendelser relevante for syfo210\n**************************************************/\nWITH hendelser as (\n  SELECT * FROM dvh_syfo.mk_dialogmote__union\n)\n\n,final as (\n  SELECT\n    *\n  FROM hendelser where hendelse in ('FERDIGSTILT', 'STOPPUNKT','UNNTAK')\n)\n\nSELECT * FROM final", "relation_name": "dvh_syfo.mk_dialogmote__filtrert_hendelse", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:18.778252Z", "completed_at": "2026-01-22T12:51:18.782031Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:18.782572Z", "completed_at": "2026-01-22T12:51:19.085889Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.32758617401123047, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__tidligste_tilfelle_startdato", "compiled": true, "compiled_code": "WITH hendelser AS (\n    SELECT * FROM dvh_syfo.mk_dialogmote__filtrert_hendelse\n)\n\n,final AS (\n  SELECT\n    hendelser.*\n    ,ROW_NUMBER() OVER(PARTITION BY fk_person1, tilfelle_startdato, hendelse ORDER BY dialogmote_tidspunkt, hendelse_tidspunkt) AS row_number\n  FROM hendelser\n)\n\nSELECT * FROM final", "relation_name": "dvh_syfo.mk_dialogmote__tidligste_tilfelle_startdato", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:19.109000Z", "completed_at": "2026-01-22T12:51:19.112625Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:19.113274Z", "completed_at": "2026-01-22T12:51:19.470008Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.380756139755249, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__pivotert", "compiled": true, "compiled_code": "WITH hendelser as (\n  SELECT aktuelle_hendelser.fk_person1,\n         aktuelle_hendelser.tilfelle_startdato,\n         aktuelle_hendelser.hendelse,\n         aktuelle_hendelser.hendelse_tidspunkt,\n         aktuelle_hendelser.dialogmote_tidspunkt,\n         aktuelle_hendelser.unntakarsak,\n         aktuelle_hendelser.enhet_nr,\n         aktuelle_hendelser.arbeidstaker_flagg,\n         aktuelle_hendelser.arbeidsgiver_flagg,\n         aktuelle_hendelser.sykmelder_flagg,\n         aktuelle_hendelser.kilde_uuid,\n         aktuelle_hendelser.kildesystem,\n         aktuelle_hendelser.virksomhetsnr,\n         aktuelle_hendelser.row_number,\n         aktuelle_hendelser.nav_ident,\n         DECODE(hendelse,'FERDIGSTILT', dialogmote_tidspunkt, hendelse_tidspunkt) AS hendelse_tidspunkt1\n  FROM dvh_syfo.mk_dialogmote__tidligste_tilfelle_startdato aktuelle_hendelser\n),\n\nunntakarsak_modia as (\n  select fk_person1,\n         tilfelle_startdato,\n         hendelse_tidspunkt1,\n         unntakarsak as unntakarsak_modia\n  from hendelser\n  where hendelse='UNNTAK'\n    and kildesystem = 'MODIA'\n)\n\n-- F\u00e5r kun virksomhetsnr fra dialogm\u00f8ter i Modia, s\u00e5 i union-tabellen f\u00e5r virksomhetsnr null-verdier idet flere tabeller sammenstilles.\n-- Joiner denne i neste steg for \u00e5 hindre feil i pivoteringen da vi f\u00e5r flere rader per fk_person1 + tilfelle_startdato (null fra Arena + kandidater og not-null fra dialogm\u00f8ter i Modia).\n,not_null_virksomhetsnr as (\n    select fk_person1, tilfelle_startdato, max(virksomhetsnr) as virksomhetsnr\n    from hendelser\n    group by fk_person1, tilfelle_startdato\n)\n\n/* Finner dialogm\u00f8ter som er avholdt av Regional Oppf\u00f8lgingsenhet (ROE) Vest-Viken.\nNav-identer som jobber for ROE Vest-Viken ligger i tabellen dim_syfo_reg_oppf_enhet_ident.\nDersom en 'FERDIGSTILT'-hendelse er registrert med en av disse identene i tidsrommet identen er gyldig, blir region_oppf_enhet_vviken_flagg satt til 1.\nNB! M\u00e5 bruke min(dialogmote_tidspunkt) for ikkje \u00e5 f\u00e5 med for mange rader. Skal berre hente eitt tidspunkt per tilfelle, */\n, dialogmote_roe as (\n  select h.fk_person1,\n         h.tilfelle_startdato,\n         min(h.hendelse_tidspunkt1) as hendelse_tidspunkt,\n         1 as region_oppf_enhet_vviken_flagg\n  from hendelser h\n  join dim_syfo_reg_oppf_enhet_ident r on r.nav_ident = h.nav_ident\n  where h.hendelse in ('FERDIGSTILT', 'UNNTAK')\n  and trunc(h.hendelse_tidspunkt1) between r.gyldig_fra_dato and r.gyldig_til_dato\n  group by h.fk_person1,\n           h.tilfelle_startdato\n)\n\n,pivotert AS (\n  SELECT * FROM (\n    SELECT\n      a.fk_person1\n      ,a.tilfelle_startdato AS tilfelle_startdato\n      ,CONCAT(a.hendelse, a.ROW_NUMBER) AS hendelse1\n      ,a.hendelse_tidspunkt1\n      ,b.virksomhetsnr\n      ,nvl(c.region_oppf_enhet_vviken_flagg,0) as region_oppf_enhet_vviken_flagg\n    FROM hendelser a\n    left join not_null_virksomhetsnr b on\n      a.fk_person1=b.fk_person1 and a.tilfelle_startdato=b.tilfelle_startdato\n    left join dialogmote_roe c on\n      a.fk_person1=c.fk_person1 and a.tilfelle_startdato=c.tilfelle_startdato\n  )\n  PIVOT(\n    MAX(hendelse_tidspunkt1) FOR hendelse1 IN (\n      'STOPPUNKT1' stoppunkt\n      ,'FERDIGSTILT1' dialogmote_tidspunkt1\n      ,'FERDIGSTILT2' dialogmote_tidspunkt2\n      ,'FERDIGSTILT3' dialogmote_tidspunkt3\n      ,'FERDIGSTILT4' dialogmote_tidspunkt4\n      ,'FERDIGSTILT5' dialogmote_tidspunkt5\n      ,'FERDIGSTILT6' dialogmote_tidspunkt6\n      ,'UNNTAK1' unntak\n    )\n  )\n  ORDER BY\n    fk_person1\n    ,tilfelle_startdato\n),\n\nfinal as (\n    SELECT distinct\n      pivotert.fk_person1,\n      pivotert.tilfelle_startdato,\n      pivotert.virksomhetsnr,\n      pivotert.stoppunkt,\n      pivotert.dialogmote_tidspunkt1,\n      pivotert.dialogmote_tidspunkt2,\n      pivotert.dialogmote_tidspunkt3,\n      pivotert.dialogmote_tidspunkt4,\n      pivotert.dialogmote_tidspunkt5,\n      pivotert.dialogmote_tidspunkt6,\n      pivotert.unntak,\n      um.unntakarsak_modia,\n      pivotert.region_oppf_enhet_vviken_flagg\n    FROM pivotert\n    left join unntakarsak_modia um on um.fk_person1 = pivotert.fk_person1\n                                  and um.tilfelle_startdato = pivotert.tilfelle_startdato\n                                  and um.hendelse_tidspunkt1 = pivotert.unntak\n )\n\nselect * from final", "relation_name": "dvh_syfo.mk_dialogmote__pivotert", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:19.500456Z", "completed_at": "2026-01-22T12:51:19.507641Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:19.508259Z", "completed_at": "2026-01-22T12:51:19.844623Z"}], "thread_id": "Thread-8 (worker)", "execution_time": 0.36809539794921875, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_motebehov__prepp", "compiled": true, "compiled_code": "WITH motebehov AS (\n    SELECT\n        motebehov.*,\n        case when fk_person1_sm = fk_person1_opprettet_av then 1 else 0 end as behov_sykm,\n        case when fk_person1_sm != fk_person1_opprettet_av then 1 else 0 end as behov_arbeidsg\n    FROM dvh_syfo.fk_modia__motebehov motebehov\n    where  motebehov.skjematype in  ('MELD_BEHOV', 'SVAR_BEHOV') and --ikke skjematype lik null (der hvor det allerede er kalt inn)\n           motebehov.har_motebehov = 1--bare de som har meldt at de har behov\n)\n\n,dm AS (\n    SELECT * FROM dvh_syfo.mk_dialogmote__pivotert\n)\n\n,motebehov_tilfelle AS (--knytter motebehov til tilfelle, velger f\u00f8rst alle tilfeller med startdato foer dato for motebehov, finner maks av disse\n    SELECT\n        motebehov.*,\n        MAX(dm.TILFELLE_STARTDATO) OVER(PARTITION BY dm.fk_person1, motebehov_uuid) AS max_tilfelle\n    FROM motebehov\n    LEFT JOIN dm ON\n        fk_person1 = motebehov.fk_person1_sm AND\n        motebehov.opprettet_dato > TILFELLE_STARTDATO\n)\n\n,foerste_behov AS (\n    SELECT\n        MIN(OPPRETTET_DATO) OVER(PARTITION BY fk_person1_sm, max_tilfelle) AS min_opprettet_dato --tidspunkt for det foerste meldte behovet\n        ,MAX(behov_sykm) OVER(PARTITION BY fk_person1_sm, max_tilfelle) as behov_sykmeldt\n        ,MAX(behov_arbeidsg) OVER(PARTITION BY fk_person1_sm, max_tilfelle) as behov_arbeidsgiver\n        ,motebehov_tilfelle.*\n    FROM\n        motebehov_tilfelle\n)\n, final as (\nSELECT DISTINCT\n    fk_person1_sm AS fk_person1\n    , max_tilfelle AS tilfelle_startdato\n    , behov_sykmeldt\n    , behov_arbeidsgiver\n    , min_opprettet_dato AS behov_meldt_dato\nFROM foerste_behov ORDER BY fk_person1_sm, max_tilfelle )\n\nselect * from final", "relation_name": "dvh_syfo.mk_motebehov__prepp", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:19.496671Z", "completed_at": "2026-01-22T12:51:19.503759Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:19.504284Z", "completed_at": "2026-01-22T12:51:19.851398Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.3754875659942627, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.mk_dialogmote__naering_ved_tilfelle_startdato", "compiled": true, "compiled_code": "with hendelser as (\n  select * from dvh_syfo.mk_dialogmote__pivotert\n),\n\nvirksomhet as (\n    select * from dvh_syfo.felles_dt_p__dim_virksomhet\n),\n\nnaering as (\n    select * from dvh_syfo.felles_dt_p__dim_naering\n),\n-- Finner riktig bedrift_naring_primar_kode basert p\u00e5 gyldighetsintervall\n-- Kan f\u00e5 ikke-gyldige virksomhetsnr fra Modia. Disse blir null selv om nummer finnes i dim_virksomhet\n-- Setter 'Ukjent'-, '00000'- og null-verdier til '-1' for \u00e5 h\u00e5ndtere join mot dim_naering\n-- '00000' ligger i naeringsstandard 'SN2002', og vil filtreres ut av endelig sett dersom ikke satt til '-1'\n-- 'Ukjent' har mange ikke-unike rader i dim_naering og vil gi for mange treff dersom ikke satt til '-1'\ndialogmoter_join_virksomhet_gyldig_tid as (\n    select\n        hendelser.* ,\n        case\n            when rtrim(bedrift_naring_primar_kode) = 'Ukjent' then '-1'\n            when rtrim(bedrift_naring_primar_kode) = '00000' then '-1'\n            when rtrim(bedrift_naring_primar_kode) is null then '-1'\n            else rtrim(bedrift_naring_primar_kode)\n        end as bedrift_naring_primar_kode\n    from hendelser\n    left join virksomhet on hendelser.virksomhetsnr = virksomhet.bedrift_org_nr\n        and  hendelser.tilfelle_startdato BETWEEN virksomhet.gyldig_fra_dato AND virksomhet.gyldig_til_dato --hendelse_tidspunkt mer ideelt, men har ikke andre tidspunkt fra hendelser \u00e5 joine p\u00e5. Ev. dialogmote2_avholdt_dato?\n),\n\n-- Finner riktig naering_kode basert p\u00e5 gyldighetsintervall\n-- Bruker n\u00e6ringsstandard 'SN2007'. Flere treff per bedrift_naring_primar_kode hvis ikke denne settes\n-- Har med naering_kode is null i where-clause for \u00e5 f\u00e5 med rader som ikke f\u00e5r treff i dim_naering/gyldighetsintervallet\ndialogmoter_join_naering_gyldig_tid as (\n    select\n        dialogmoter_join_virksomhet_gyldig_tid.*,\n        NVL(pk_dim_naering, -1) as fk_dim_naering\n    from dialogmoter_join_virksomhet_gyldig_tid\n    left join naering on naering.naering_kode = dialogmoter_join_virksomhet_gyldig_tid.bedrift_naring_primar_kode\n        and tilfelle_startdato between naering.gyldig_fra_dato and naering.gyldig_til_dato\n    where naeringsstandard='SN2007' or naering_kode is null\n),\n\nfinal as (\n    select * from dialogmoter_join_naering_gyldig_tid\n)\n\nselect * from final", "relation_name": "dvh_syfo.mk_dialogmote__naering_ved_tilfelle_startdato", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T12:51:19.875210Z", "completed_at": "2026-01-22T12:51:19.884974Z"}, {"name": "execute", "started_at": "2026-01-22T12:51:19.885540Z", "completed_at": "2026-01-22T13:11:10.378657Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 1190.5947699546814, "adapter_response": {"_message": "OK", "rows_affected": 0}, "message": "OK", "failures": null, "unique_id": "model.dmx_poc.fak_dialogmote", "compiled": true, "compiled_code": "\n\n\nWITH hendelser AS (\n  SELECT * FROM dvh_syfo.mk_dialogmote__pivotert\n  \n  -- Filtrerer p\u00e5 tilfeller hvor:\n  -- 1. Nye tilfeller siste 180 dager, ELLER\n  -- 2. Tilfeller med aktivitet (dialogm\u00f8ter/unntak) siste 7 dager\n  WHERE (\n    tilfelle_startdato >= TRUNC(SYSDATE) - 180\n    OR\n    GREATEST(\n      NVL(dialogmote_tidspunkt1, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(dialogmote_tidspunkt2, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(dialogmote_tidspunkt3, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(dialogmote_tidspunkt4, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(dialogmote_tidspunkt5, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(dialogmote_tidspunkt6, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(unntak, TO_DATE('1900-01-01', 'YYYY-MM-DD')),\n      NVL(stoppunkt, TO_DATE('1900-01-01', 'YYYY-MM-DD'))\n    ) >= CURRENT_DATE - 7\n  )\n  \n)\n\n,dim_person1 AS (\n  SELECT * FROM dvh_syfo.felles_dt_person__dim_person1\n)\n\n,dim_organisasjon AS (\n  SELECT * FROM dvh_syfo.felles_dt_kodeverk__dim_organisasjon\n)\n\n,dim_org AS (\n  SELECT * FROM dvh_syfo.felles_dt_kodeverk__dim_org\n)\n\n,motebehov AS (\n  SELECT * FROM dvh_syfo.mk_motebehov__prepp\n)\n\n,dim_alder as (\n  select * from dvh_syfo.felles_dt_kodeverk__dim_alder\n)\n\n,hendelser_med_naering as (\n  select * from dvh_syfo.mk_dialogmote__naering_ved_tilfelle_startdato\n)\n\n,dm_2 as (\n/*\nSetter dialogmote2_avholdt_dato basert p\u00e5 reglene:\n1. Hvis dialogmote_tidspunkt1 = NULL,                             => NULL\n2. Hvis dialogmote_tidspunkt1 > unntak,                           => NULL (det er bare \u00e5 f\u00e5 unntak kun for dialogm\u00f8te 2)\n3. Hvis (dialogmote_tidspunkt1 - tilfelle_startdato) > 365 dager, => NULL\n4. Hvis unntak = NULL,                                            => dialogmote_tidspunkt1\n5. Hvis dialogmote_tidspunkt1 < unntak,                           => dialogmote_tidspunkt1\n*/\n  select fk_person1,\n         tilfelle_startdato,\n         dialogmote_tidspunkt1,\n         dialogmote_tidspunkt2,\n         dialogmote_tidspunkt3,\n         dialogmote_tidspunkt4,\n         dialogmote_tidspunkt5,\n         dialogmote_tidspunkt6,\n    CASE\n      WHEN (dialogmote_tidspunkt1 is null) or (dialogmote_tidspunkt1 > unntak)\n                                           or (extract(day from (dialogmote_tidspunkt1 - tilfelle_startdato))) > 365 then null\n      WHEN unntak is null then dialogmote_tidspunkt1\n      WHEN dialogmote_tidspunkt1 < unntak then dialogmote_tidspunkt1\n    END AS dialogmote2_avholdt_dato\n  from dvh_syfo.mk_dialogmote__pivotert\n  ),\n\ndm_3 as (\n/*\nSetter dialogmoteX_avholdt_dato basert p\u00e5 reglene:\n1. Hvis dialogmote2_avholdt_dato = NULL (unntak) og tidspunkt for dialogm\u00f8tehendelse er under 365 dager siden sykefrav\u00e6rtilfelle => dialogmote_tidspunkt_(X-1)\n2. Hvis dialogmote2_avholdt_dato != NULL (ikke unntak) og tidspunkt for dialogm\u00f8tehendelse er under 365 dager siden sykefrav\u00e6rtilfelle => dialogmote_tidspunkt_X\n2. Ellers NULL\n*/\n  select dm_2.*,\n    CASE\n      WHEN dialogmote2_avholdt_dato is null and extract(day from (dialogmote_tidspunkt1 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt1\n      WHEN dialogmote2_avholdt_dato is not null and extract(day from (dialogmote_tidspunkt2 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt2\n      else null\n    END AS dialogmote3_avholdt_dato\n  from dm_2\n  ),\n\ndm_4 as (\n\n  select dm_3.*,\n    CASE\n      WHEN dialogmote2_avholdt_dato is null and extract(day from (dialogmote_tidspunkt2 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt2\n      WHEN dialogmote2_avholdt_dato is not null and extract(day from (dialogmote_tidspunkt3 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt3\n      else null\n    END AS dialogmote4_avholdt_dato\n  from dm_3\n  ),\n\ndm_5 as (\n\n  select dm_4.*,\n    CASE\n      WHEN dialogmote2_avholdt_dato is null and extract(day from (dialogmote_tidspunkt3 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt3\n      WHEN dialogmote2_avholdt_dato is not null and extract(day from (dialogmote_tidspunkt4 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt4\n      else null\n    END AS dialogmote5_avholdt_dato\n  from dm_4\n  ),\n\ndm_6 as (\n\n  select dm_5.*,\n    CASE\n      WHEN dialogmote2_avholdt_dato is null and extract(day from (dialogmote_tidspunkt4 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt4\n      WHEN dialogmote2_avholdt_dato is not null and extract(day from (dialogmote_tidspunkt5 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt5\n      else null\n    END AS dialogmote6_avholdt_dato\n  from dm_5\n  ),\n\ndm_7 as (\n\n  select dm_6.*,\n    CASE\n      WHEN dialogmote2_avholdt_dato is null and extract(day from (dialogmote_tidspunkt5 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt5\n      WHEN dialogmote2_avholdt_dato is not null and extract(day from (dialogmote_tidspunkt6 - tilfelle_startdato)) <= 365 then dialogmote_tidspunkt6\n      else null\n    END AS dialogmote7_avholdt_dato\n  from dm_6\n  ),\n\ndm_2_7 as (\n/*\nSamler alle dialogmote_avholdt_dato fra dm_2 til dm_7\n*/\n  select fk_person1,\n         tilfelle_startdato,\n         dialogmote2_avholdt_dato,\n         dialogmote3_avholdt_dato,\n         dialogmote4_avholdt_dato,\n         dialogmote5_avholdt_dato,\n         dialogmote6_avholdt_dato,\n         dialogmote7_avholdt_dato\n  from dm_7\n)\n-- Trengs dm3-7 i SELECT her?\n,flagg_innen_26Uker AS (\n  SELECT fk_person1,\n         tilfelle_startdato,\n         dialogmote2_avholdt_dato,\n         dialogmote3_avholdt_dato,\n         dialogmote4_avholdt_dato,\n         dialogmote5_avholdt_dato,\n         dialogmote6_avholdt_dato,\n         dialogmote7_avholdt_dato,\n    CASE\n      WHEN dialogmote2_avholdt_dato IS NULL THEN NULL\n      WHEN dialogmote2_avholdt_dato < (tilfelle_startdato + 26*7) THEN 1\n      ELSE 0\n    END AS dialogmote2_innen_26_uker_flagg\n  FROM dm_2_7\n)\n\n\n\n,joined AS (\n  SELECT\n    hendelser.fk_person1\n    ,hendelser.tilfelle_startdato\n    ,hendelser.virksomhetsnr\n    ,dialogmote2_innen_26_uker_flagg AS dm2_innen_26_uker_flagg\n    ,behov_meldt_dato\n    ,behov_sykmeldt\n    ,behov_arbeidsgiver\n    ,dialogmote2_avholdt_dato\n    ,dialogmote3_avholdt_dato\n    ,dialogmote4_avholdt_dato\n    ,dialogmote5_avholdt_dato\n    ,dialogmote6_avholdt_dato\n    ,dialogmote7_avholdt_dato\n    ,hendelser.unntak AS unntak_dato\n    ,hendelser.unntakarsak_modia\n    ,TRUNC(hendelser.tilfelle_startdato + 26*7, 'MM') AS tilfelle_26uker_mnd_startdato\n    ,dim_person1.fk_dim_organisasjon\n    ,NVL(TO_NUMBER(\n      TO_CHAR(motebehov.behov_meldt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__behov_meldt\n    ,NVL(TO_NUMBER(\n      TO_CHAR(hendelser.tilfelle_startdato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__tilfelle_startdato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote2_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm2_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote3_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm3_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote4_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm4_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote5_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm5_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote6_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm6_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(dialogmote7_avholdt_dato, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__dm7_avholdt_dato\n    ,NVL(TO_NUMBER(\n      TO_CHAR(hendelser.unntak, 'YYYYMMDD')\n    ), -1) AS fk_dim_tid__unntak_dato\n    , NVL(dim_alder.pk_dim_alder, -1) as fk_dim_alder\n    , NVL(dim_person1.fk_dim_kjonn, -1) as fk_dim_kjonn\n    , fk_dim_naering\n    , hendelser.region_oppf_enhet_vviken_flagg as region_oppf_enhet_vviken_flagg\n  FROM hendelser\n  LEFT JOIN dim_person1 ON\n    hendelser.fk_person1 = dim_person1.fk_person1 AND\n    hendelser.tilfelle_startdato BETWEEN dim_person1.gyldig_fra_dato AND dim_person1.gyldig_til_dato\n    -- Brukers virksomhetsnr, kj\u00f8nn og organisasjon v/tilfelle_startdato\n  LEFT JOIN flagg_innen_26Uker ON\n    hendelser.fk_person1 = flagg_innen_26Uker.fk_person1 AND\n    hendelser.tilfelle_startdato = flagg_innen_26Uker.tilfelle_startdato\n  LEFT JOIN dim_organisasjon ON\n    dim_person1.fk_dim_organisasjon = dim_organisasjon.pk_dim_organisasjon\n  LEFT JOIN dim_org ON\n    dim_organisasjon.mapping_node_kode = dim_org.mapping_node_kode AND\n    dim_org.funk_gyldig_til_dato = TO_DATE('9999-12-31', 'YYYY-MM-DD') AND -- TODO: B\u00f8r settes p\u00e5 en annen m\u00e5te\n    dim_org.mapping_node_type = 'NORGENHET'\n  LEFT JOIN motebehov ON\n    hendelser.fk_person1 = motebehov.fk_person1 AND\n    hendelser.tilfelle_startdato = motebehov.tilfelle_startdato\n  LEFT JOIN dim_alder ON\n   -- dim_alder.alder = TRUNC(MONTHS_BETWEEN(hendelser.tilfelle_startdato, dim_person1.fodt_dato)/12) -- Brukt til m\u00e5nedlig rapportering - feil?\n    dim_alder.alder = floor((hendelser.tilfelle_startdato-dim_person1.fodt_dato)/365.25)\n    and hendelser.tilfelle_startdato between dim_person1.gyldig_fra_dato AND dim_person1.gyldig_til_dato\n  LEFT JOIN hendelser_med_naering ON\n    hendelser.fk_person1 = hendelser_med_naering.fk_person1\n    and hendelser.tilfelle_startdato = hendelser_med_naering.tilfelle_startdato\n\n  )\n\n,final as (\n  select\n    fk_person1,\n    tilfelle_startdato,\n    virksomhetsnr,\n    dm2_innen_26_uker_flagg,\n    behov_meldt_dato,\n    behov_sykmeldt,\n    behov_arbeidsgiver,\n    dialogmote2_avholdt_dato,\n    dialogmote3_avholdt_dato,\n    dialogmote4_avholdt_dato,\n    dialogmote5_avholdt_dato,\n    dialogmote6_avholdt_dato,\n    dialogmote7_avholdt_dato,\n    unntak_dato,\n    unntakarsak_modia,\n    tilfelle_26uker_mnd_startdato,\n    fk_dim_organisasjon,\n    fk_dim_tid__behov_meldt,\n    fk_dim_tid__tilfelle_startdato,\n    fk_dim_tid__dm2_avholdt_dato,\n    fk_dim_tid__dm3_avholdt_dato,\n    fk_dim_tid__dm4_avholdt_dato,\n    fk_dim_tid__dm5_avholdt_dato,\n    fk_dim_tid__dm6_avholdt_dato,\n    fk_dim_tid__dm7_avholdt_dato,\n    fk_dim_tid__unntak_dato,\n    fk_dim_alder,\n    fk_dim_kjonn,\n    fk_dim_naering,\n    region_oppf_enhet_vviken_flagg\n  from joined\n)\n\nSELECT * FROM final", "relation_name": "dvh_syfo.fak_dialogmote", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-22T13:11:10.764474Z", "completed_at": "2026-01-22T13:11:10.771579Z"}, {"name": "execute", "started_at": "2026-01-22T13:11:10.772281Z", "completed_at": "2026-01-22T13:11:13.302760Z"}], "thread_id": "main", "execution_time": 2.538286, "adapter_response": {}, "message": "dmx_poc.on-run-end.0 passed", "failures": 0, "unique_id": "operation.dmx_poc.dmx_poc-on-run-end-0", "compiled": true, "compiled_code": "\n    -- Oppdater alt med roller i databasen.\n  begin\n    ssr_mtn.update_access_role_privs_in_db;\n  end;\n", "relation_name": null, "batch_results": null}], "elapsed_time": 1200.7826280593872, "args": {"write_json": true, "log_format": "default", "exclude": [], "require_batched_execution_for_custom_microbatch_strategy": false, "populate_cache": true, "print": true, "require_nested_cumulative_type_params": false, "require_resource_names_without_spaces": false, "require_yaml_configuration_for_mf_time_spines": false, "use_colors": true, "log_path": "/home/user/github/dvh-sykefravar-dmx/logs", "use_colors_file": true, "warn_error_options": {"include": [], "exclude": []}, "send_anonymous_usage_stats": false, "project_dir": "/home/user/github/dvh-sykefravar-dmx", "version_check": true, "state_modified_compare_vars": false, "which": "run", "log_format_file": "debug", "cache_selected_only": false, "partial_parse_file_diff": true, "indirect_selection": "eager", "vars": {}, "empty": false, "show_resource_report": false, "quiet": false, "printer_width": 80, "defer": false, "partial_parse": true, "select": ["+fak_dialogmote"], "log_file_max_bytes": 10485760, "require_explicit_package_overrides_for_builtin_materializations": true, "introspect": true, "skip_nodes_if_on_run_start_fails": false, "log_level_file": "debug", "macro_debugging": false, "source_freshness_run_project_hooks": false, "state_modified_compare_more_unrendered_values": false, "static_parser": true, "log_level": "info", "profiles_dir": "/home/user/github/dvh-sykefravar-dmx", "strict_mode": false, "favor_state": false, "invocation_command": "dbt run --select +fak_dialogmote"}}